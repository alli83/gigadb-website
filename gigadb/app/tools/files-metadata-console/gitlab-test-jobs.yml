files_metadata_console_tests:
  stage: test
  dependencies: []
  script:
    - env | grep "^HOME_URL" >> $APPLICATION/.env
    - env | grep "^GIGADB_" >> $APPLICATION/.secrets
    - docker pull registry.gitlab.com/$CI_PROJECT_PATH/application:latest || true
    - docker pull registry.gitlab.com/$CI_PROJECT_PATH/test:latest || true
    - docker pull registry.gitlab.com/$CI_PROJECT_PATH/console:latest || true
    - docker pull registry.gitlab.com/$CI_PROJECT_PATH/web:latest || true
    - ./up.sh
    - cd gigadb/app/tools/files-metadata-console
    - docker-compose -f ./docker-compose.yml run --rm composer install
    - docker-compose -f ./docker-compose.yml run --rm console ./vendor/bin/codecept run functional
  environment:
    name: dev